<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <script src="scripts/d3.js"></script>
  <title>Postgres node.js template med d3.js</title>
</head>

<body>
  <h1>Postgres node.js template med d3.js</h1>

  <button id="Agurk"><b>Agurk</b></button>
  <button id="Tomat"><b>Tomat</b></button>
  <button id="data3"><b>Æble</b></button>
  <svg width="100%" height="300" style="border:1px solid black" id="svg1">
    <circle cx="50" cy="50" r="40" stroke="green" stroke-width="4" fill="yellow" />

  </svg>


  <script type="text/javascript">

    // Width og height
    const w = 1000;
    const h = 100;
    const barPadding = 1; // Bruges til at lave afstand imellem søjler

    // Selve datasættet
    let dataset = [5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
      11, 12, 15, 20, 18, 17, 16, 18, 23, 25];

    // Lav SVG-elementet
    const svg = d3.select("body")
      .append("svg")
      .attr("width", w)
      .attr("height", h);


    d3.select("#Agurk")
      // Koden herunder køres kun ved tryk på knappen
      .on("click", function () {
        console.log(`Agurk clicked`)

        d3.json("/api/frugt/agurk", {
          method: "POST",
        }).then(function (response) {
          const data = response.data; // Hent data ud af response
          dataset.push(`${data[0].totalkgco2}`);
          generateBarchart()
        })
      });


    d3.select("#Tomat")
      // Koden herunder køres kun ved tryk på knappen
      .on("click", function () {
        console.log(`Tomat clicked`)

        d3.json("/api/frugt/Tomat", {
          method: "POST",
        }).then(function (response) {
          const data = response.data; // Hent data ud af response
          dataset.push(`${data[0].totalkgco2}`);
          generateBarchart()
        })
      });






























    // Denne query kører op imod API'en som findes i 'main.js'.
    // Denne HTML skal derfor åbnes igennem serveren for at virke.
    d3.json("/api/frugt/agurk", {
      method: "POST",
    }).then(function (response) {
      const data = response.data; // Hent data ud af response
      console.log("data:", data);

      for (let q = 0; q < data.length; q++) {
        console.log(data[q]);
        console.log(`totalkgco2: ${data[q].totalkgco2}`);
      }




      const w = 500;
      const h = 350;

      // Lav SVG element
      const svg = d3.select("body")
        .append("svg")
        .attr("width", w)
        .attr("height", h)
        .attr("style", "border:1px solid black");

      // Indsæt tekst fra postgres query som eksempel
      console.log("Indsæt tekst fra postgres query som eksempel")
      let textLabel = "";
      svg.selectAll("text")
        .data(data)
        .enter()
        .append("text")
        .attr("x", 20)
        .attr("y", 20)
        .text(function (d) {
          textLabel += `${d.navn} `
          console.log(`${d.navn}`)
        })
        .text(`Svar fra database: ${textLabel}`)
      console.log(`textLabel: ${textLabel}`)
      // Lav din egen visualsering med data her!
    });


    function generateBarchart() {
      // Lave barchart (søjlediagram)
      svg.selectAll("rect")
        .data(dataset)
        .enter()
        .append("rect")
        // 'd' er datapunktet
        // 'i' er index i datasættet
        .attr("x", function (d, i) {
          // Søjlerne spredes jævnt ud over 'w'
          return i * (w / dataset.length);
        })
        .attr("y", function (d) {
          // 'y' er position for søjlens øverste kant
          // Husk, y-aksen vender på hovedet!
          return h - (d * 4);
        })
        // Bredden er fast - og afhænger af 'w' og antallet af datapunkter
        .attr("width", w / dataset.length - barPadding) // Padding skaber luft imellem søjler
        // Højden er datapunktet * 4. 
        .attr("height", function (d) {
          return d * 4;
        })
        // Alle søjler er farvet 'teal'
        .attr("fill", "teal");
    }

    generateBarchart()
  </script>
</body>

</html>